openapi: 3.1.0
info:
  title: ChatPG
  version: 1.0.0

servers:
  - url: "http://127.0.0.1:8080/api"



paths:
  /auth/login:
    post:
      description: Receives account's credentials and returns the access token in a TokenDto object, and appends a cookie containing the refresh token to the response.
      tags:
        - AuthController
      security: []
      requestBody:
        description:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/LoginCredentials"
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Token"
        '401':
          description: Unauthorized
          content:
            text/plain:
              schema:
                type: string
                examples: ["Wrong password"]
        '404':
          description: Not Found
          content:
            text/plain:
              schema:
                type: string
                examples: ["Account not found"]
  /auth/logout:
    post:
      description: Clears the account's refresh token.
      tags:
        - AuthController
      responses:
        '204':
          description: No Content
        '401':
          $ref: "#/components/responses/Unauthorized"
  /auth/refreshToken:
    post:
      description: Refreshes 'Access' and 'Refresh' tokens.
      tags:
        - AuthController
      security: []
      responses:
        '204':
          description: No Content
        '401':
          $ref: "#/components/responses/Unauthorized"
  /auth/requestChangePassword:
    post:
      description: Requests change of password, sending an email to the provided address with the link containing the UUID that identifies the request.
      tags:
        - AuthController
      security: []
      requestBody:
        description:
        content:
          text/plain:
            schema:
              type: string
              examples: ["johnDoe@email.com"]
      responses:
        '204':
          description: No Content
        '401':
          $ref: "#/components/responses/Unauthorized"
  /auth/confirmChangePassword:
    post:
      description: Confirms the requested password change.
      tags:
        - AuthController
      security: []
      requestBody:
        description:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ChangePasswordDto"
      responses:
        '204':
          description: No Content
        '403':
          $ref: "#/components/responses/Forbidden"
  /auth/createAccount:
    post:
      description: Creates a, still disabled, account. An email, together with an uuid, which identifies the request of account creation, is sent to the address given in the requestBody to activate the account.
      tags:
        - AuthController
      security: []
      requestBody:
        description:
        content:
          text/plain:
            schema:
              $ref: "#/components/schemas/CreateAccountDto"
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                $ref:  "#/components/schemas/Account"
        '400':
          description: Bad Request
          content:
            text/plain:
              schema:
                type: string
                examples: ["Invalid email", "Username already taken", "Email already registered"]
  /auth/activateAccount:
    post:
      description: Activates the account using the uuid sent to the email as identifier of the request to fulfill.
      tags:
        - AuthController
      security: []
      requestBody:
        description:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UuidDto"
      responses:
        '204':
          description: No Content
        '403':
          $ref: "#/components/responses/Forbidden"
        '409':
          description: Conflict
          content:
            text/plain:
              schema:
                type: string
                examples: ["That account was already activated"]
  /account/current:
    get:
      description: Returns the AccountDto of the current logged account.
      tags:
        - AccountController
      responses:
        '200':
          description: Success
          content:
            text/plain:
              schema:
                type: boolean
                examples: [true]
        '401':
          $ref: "#/components/responses/Unauthorized"
  "/models/isModelAvailable/{modelName}":
    get:
      description: Returns a boolean on whether the model name given is of a supported model.
      tags:
        - ModelController
      parameters:
        - name: modelName
          in: path
          schema:
            type: string
          required: true
      responses:
        '200':
          description: Success
          content:
            text/plain:
              schema:
                type: boolean
                examples: [true]
        '401':
          $ref: "#/components/responses/Unauthorized"
  "/models/all":
    get:
      description: Returns an array with the name of all available AI models.
      tags:
        - ModelController
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: array
                examples: [[
                  "gemini-2.5-flash",
                  "gpt-oss-20b",
                  "gemma-3-4b-it"
                ]]
        '401':
          $ref: "#/components/responses/Unauthorized"
  /chats/all:
    get:
      description: Returns a list of ChatDto of the chats the current logged account has access to.
      tags:
        - ChatController
      responses:
        '200':
          description: Success
          $ref: "#/components/schemas/ChatArray"
        '401':
          $ref: "#/components/responses/Unauthorized"
  "/chats/byName/{chatName}":
    get:
      description: "Returns, if any, a chat the current logged account has access to and that has the given name. If none attends to the criteria, returns 404(Not Found)."
      tags:
        - ChatController
      parameters:
        - name: chatName
          in: path
          schema:
            type: string
          required: true
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Chat2"
        '401':
          $ref: "#/components/responses/Unauthorized"
        '404':
          $ref: "#/components/responses/ChatNotFound"
  "/chats/{chatId}/model":
    patch:
      description: Selects another AI model to be active on the chat.
      tags:
        - ChatController
      parameters:
        - name: chatId
          in: path
          schema:
            type: integer
          required: true
      responses:
        '204':
          description: No content
        '401':
          $ref: "#/components/responses/Unauthorized"
        '403':
          $ref: "#/components/responses/ChatForbidden"
        '404':
          $ref: "#/components/responses/ChatNotFound"
    get:
      description: Gets the AI model active on the chat.
      tags:
        - ChatController
      parameters:
        - name: chatId
          in: path
          schema:
            type: integer
          required: true
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AiModel"
        '401':
          $ref: "#/components/responses/Unauthorized"
        '403':
          $ref: "#/components/responses/ChatForbidden"
        '404':
          $ref: "#/components/responses/ChatNotFound"
  "/chats/{chatId}/messages/{messageId}":
    get:
      description: Returns the MessageDto of the message specified by the ID.
      tags:
        - MessageController
      parameters:
        - name: chatId
          in: path
          schema:
            type: integer
          required: true
        - name: messageId
          in: path
          schema:
            type: integer
          required: true
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Message"
        '401':
          $ref: "#/components/responses/Unauthorized"
        '403':
          $ref: "#/components/responses/ChatForbidden"
        '404':
          $ref: "#/components/responses/ChatOrMessageNotFound"
    delete:
      description: Deletes the message specified by the ID.
      tags:
        - MessageController
      parameters:
        - name: chatId
          in: path
          schema:
            type: integer
          required: true
        - name: messageId
          in: path
          schema:
            type: integer
          required: true
      responses:
        '204':
          description: No content
        '401':
          $ref: "#/components/responses/Unauthorized"
        '403':
          $ref: "#/components/responses/ChatForbidden"
        '404':
          $ref: "#/components/responses/ChatOrMessageNotFound"
  "/chats/{chatId}/messages/new/{referenceId}":
    get:
      description: Gets a chunk of messages from a chat with a reference ID of the last message loaded, loading the messages with greater ID, and therefore, fresher than the last loaded.
      tags:
        - MessageController
      parameters:
        - name: chatId
          in: path
          schema:
            type: integer
          required: true
        - name: referenceId
          in: path
          schema:
            type: integer
          required: true
      responses:
        '200':
          description: Success
          $ref: "#/components/schemas/MessageArray"
        '401':
          $ref: "#/components/responses/Unauthorized"
        '403':
          $ref: "#/components/responses/ChatForbidden"
        '404':
          $ref: "#/components/responses/ChatNotFound"
  "/chats/{chatId}/messages/old/{referenceId}":
    get:
      description: Gets a chunk of messages from a chat with a reference ID of the last message loaded, loading the messages with smaller ID, and therefore, older than the last loaded.
      tags:
        - MessageController
      parameters:
        - name: chatId
          in: path
          schema:
            type: integer
          required: true
        - name: referenceId
          in: path
          schema:
            type: integer
          required: true
      responses:
        '200':
          description: Success
          $ref: "#/components/schemas/MessageArray2"
        '401':
          $ref: "#/components/responses/Unauthorized"
        '403':
          $ref: "#/components/responses/ChatForbidden"
        '404':
          $ref: "#/components/responses/ChatNotFound"
  "/chats/{chatId}/messages/generateResponse":
    post:
      description: Requests the message generation as response with the AI model currently selected.
      tags:
        - MessageController
      parameters:
        - name: chatId
          in: path
          schema:
            type: integer
          required: true
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AiMessage"
        '400':
          $ref: "#/components/responses/BadRequestModel"
        '401':
          $ref: "#/components/responses/Unauthorized"
        '403':
          $ref: "#/components/responses/ChatForbidden"
        '404':
          $ref: "#/components/responses/ChatNotFound"
  "/chats/{chatId}/messages/bulkDelete/{bound1}/{bound2}":
    delete:
      description: Deletes the messages in the inclusive range of IDs between bound1 and bound2.
      tags:
        - MessageController
      parameters:
        - name: chatId
          in: path
          schema:
            type: integer
          required: true
        - name: bound1
          in: path
          schema:
            type: integer
          required: true
        - name: bound2
          in: path
          schema:
            type: integer
          required: true
      responses:
        '204':
          description: No content
        '401':
          $ref: "#/components/responses/Unauthorized"
        '403':
          $ref: "#/components/responses/ChatForbidden"
        '404':
          $ref: "#/components/responses/MessageNotDeleted"
  "/chats/{chatId}/polls/start":
    post:
      description: "Starts a poll with the given topic (Command to be run)."
      tags:
        - PollController
      parameters:
        - name: chatId
          in: path
          schema:
            type: integer
          required: true
      requestBody:
        description:
        content:
          text/plain:
            schema:
              type: string
              examples: ["REQUEST_AI_MESSAGE"]
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Poll"
        '401':
          $ref: "#/components/responses/Unauthorized"
        '403':
          $ref: "#/components/responses/ChatForbidden"
        '404':
          $ref: "#/components/responses/ChatNotFound"
  "/chats/{chatId}/polls/vote":
    post:
      description: "Votes in the poll, if any active, of topic given, i.e. the command to be run"
      tags:
        - PollController
      parameters:
        - name: chatId
          in: path
          schema:
            type: integer
          required: true
      requestBody:
        description:
        content:
          text/plain:
            schema:
              type: string
              examples: ["REQUEST_AI_MESSAGE"]
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Poll2"
        '401':
          $ref: "#/components/responses/Unauthorized"
        '403':
          $ref: "#/components/responses/ChatForbidden"
        '404':
          $ref: "#/components/responses/ChatNotFound"
  "/chats/{chatId}/polls/all":
    get:
      description: Gets all the active polls in a chat.
      tags:
        - PollController
      parameters:
        - name: chatId
          in: path
          schema:
            type: integer
          required: true
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Poll2"
        '401':
          $ref: "#/components/responses/Unauthorized"
        '403':
          $ref: "#/components/responses/ChatForbidden"
        '404':
          $ref: "#/components/responses/ChatNotFound"



security:
  - auth: []

components:
  schemas:
    Account:
      type: object
      properties:
        id:
          type: integer
          format: int64
          examples: [2]
        name:
          type: string
          examples: ["John Doe"]
    Account2:
      type: object
      properties:
        id:
          type: integer
          format: int64
          examples: [3]
        name:
          type: string
          examples: ["Jane Doe"]
    AiModel:
      type: object
      properties:
        nickname:
          type: string
          examples: ["gemini-2.5-flash"]
    LoginCredentials:
      type: object
      properties:
        username:
          type: string
          examples: ["John Doe"]
        password:
          type: string
          examples: ["verynicepassword"]
    Token:
      type: object
      properties:
        token:
          type: string
          examples: ["9278ebf05bc999c95dce8e34b8e3ae460df6992c6d243b55325c818444a7cfeb"]
    Chat:
      type: object
      properties:
        id:
          type: integer
          format: int64
          examples: [3]
        name:
          type: string
          examples: ["Chat about bananas"]
    Chat2:
      type: object
      properties:
        id:
          type: integer
          format: int64
          examples: [5]
        name:
          type: string
          examples: ["Chat about pumpkins"]
    ChatArray:
      type: array
      content:
        application/json:
          schema:
            type: array
            examples: [[
              {
                id: 3,
                name: "Chat about bananas"
              },
              {
                id: 5,
                name: "Chat about pumpkins"
              }
            ]]
    Message:
      type: object
      properties:
        id:
          type: integer
          format: int64
          examples: [1648]
        content:
          type: string
          examples: ["Good morning!"]
        isBot:
          type: boolean
          examples: [false]
        account:
          $ref: "#/components/schemas/Account"
    AiMessage:
      type: object
      properties:
        id:
          type: integer
          format: int64
          examples: [9001]
        content:
          type: string
          examples: ["Good morning! I hope your day is off to a productive start. How may I assist you with your objectives today?"]
        isBot:
          type: boolean
          examples: [true]
        account:
          type: object
          examples: [null]
    MessageArray:
      type: array
      content:
        application/json:
          schema:
            type: array
            examples: [[
              {
                id: 5021,
                content: "good morning",
                isBot: false,
                account: {
                  id: 3,
                  name: "John Doe"
                }
              },
              {
                id: 5022,
                content: "i need those papers",
                isBot: false,
                account: {
                  id: 3,
                  name: "John Doe"
                }
              }
            ]]
    MessageArray2:
      type: array
      content:
        application/json:
          schema:
            type: array
            examples: [[
              { "id": 5001, "content": "did you see the email?", "isBot": false, "account": { "id": 10, "name": "John Doe" } },
              { "id": 5002, "content": "which one?", "isBot": false, "account": { "id": 11, "name": "Jane Doe" } },
              { "id": 5003, "content": "the one about the schedule change for friday", "isBot": false, "account": { "id": 10, "name": "John Doe" } },
              { "id": 5004, "content": "checking now", "isBot": false, "account": { "id": 11, "name": "Jane Doe" } },
              { "id": 5005, "content": "oh i see it", "isBot": false, "account": { "id": 11, "name": "Jane Doe" } },
              { "id": 5006, "content": "yeah that works for me", "isBot": false, "account": { "id": 11, "name": "Jane Doe" } },
              { "id": 5007, "content": "cool just making sure everyone saw it", "isBot": false, "account": { "id": 10, "name": "John Doe" } },
              { "id": 5008, "content": "actually wait", "isBot": false, "account": { "id": 11, "name": "Jane Doe" } },
              { "id": 5009, "content": "i might be a few mins late", "isBot": false, "account": { "id": 11, "name": "Jane Doe" } },
              { "id": 5010, "content": "all good", "isBot": false, "account": { "id": 10, "name": "John Doe" } },
              { "id": 5011, "content": "should we start without you?", "isBot": false, "account": { "id": 10, "name": "John Doe" } },
              { "id": 5012, "content": "yeah go ahead", "isBot": false, "account": { "id": 11, "name": "Jane Doe" } },
              { "id": 5013, "content": "i'll just catch up when i get there", "isBot": false, "account": { "id": 11, "name": "Jane Doe" } },
              { "id": 5014, "content": "sounds like a plan", "isBot": false, "account": { "id": 10, "name": "John Doe" } },
              { "id": 5015, "content": "anyone else coming?", "isBot": false, "account": { "id": 11, "name": "Jane Doe" } },
              { "id": 5016, "content": "i think mark said he was busy", "isBot": false, "account": { "id": 10, "name": "John Doe" } },
              { "id": 5017, "content": "classic mark", "isBot": false, "account": { "id": 11, "name": "Jane Doe" } },
              { "id": 5018, "content": "true lol", "isBot": false, "account": { "id": 10, "name": "John Doe" } },
              { "id": 5019, "content": "anyway talk later", "isBot": false, "account": { "id": 11, "name": "Jane Doe" } },
              { "id": 5020, "content": "later", "isBot": false, "account": { "id": 10, "name": "John Doe" } }
            ]]
    Poll:
      type: object
      properties:
        chat:
          $ref: "#/components/schemas/Chat"
        subject:
          type: string
          enum:
            - REQUEST_AI_MESSAGE
        quota:
          type: integer
          format: int32
          examples: [4]
        votes:
          type: integer
          format: int32
          examples: [2]
    Poll2:
      type: object
      properties:
        chat:
          $ref: "#/components/schemas/Chat"
        subject:
          type: string
          enum:
            - REQUEST_AI_MESSAGE
        quota:
          type: integer
          format: int32
          examples: [4]
        votes:
          type: integer
          format: int32
          examples: [3]
    ChangePasswordDto:
      type: object
      properties:
        uuid:
          type: string
          examples: ["aed8d388-7325-485b-b1c3-248c7a7d55fa"]
        password:
          type: string
          examples: ["password"]
    CreateAccountDto:
      type: object
      properties:
        username:
          type: string
          examples: ["JaneDoe"]
        email:
          type: string
          examples: ["JaneDoe@email.com"]
        password:
          type: string
          examples: ["password"]
    UuidDto:
      type: object
      properties:
        uuid:
          type: string
          examples: ["aed8d388-7325-485b-b1c3-248c7a7d55fa"]


  securitySchemes:
    auth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  responses:
    Unauthorized:
      description: Unauthorized
      content:
        text/plain:
          schema:
            type: string
            examples: ["Unauthorized"]
    ChatForbidden:
      description: Forbidden
      content:
        text/plain:
          schema:
            type: string
            examples: ["You do not have access to that chat"]
    Forbidden:
      description: Forbidden
      content:
        text/plain:
          schema:
            type: string
            examples: ["Forbidden"]
    ChatNotFound:
      description: Not found
      content:
        text/plain:
          schema:
            type: string
            examples: ["Chat not found"]
    ChatOrMessageNotFound:
      description: Not found
      content:
        text/plain:
          schema:
            type: string
            examples: ["Chat not found", "Message not found"]
    BadRequestModel:
      description: Bad request
      content:
        text/plain:
          schema:
            type: string
            examples: ["Model cannot be \"none\" to request ai message."]
    MessageNotDeleted:
      description: Not found
      content:
        text/plain:
          schema:
            type: string
            examples: ["No messages deleted"]